# Aceoripa 開発ガイド

## 各端末の役割と責任範囲

### 端末1: フロントエンド UI/UX
**責任範囲**: ユーザーインターフェース、レスポンシブデザイン、アニメーション

**主要ファイル**:
- `src/app/` - Next.jsページコンポーネント
- `src/components/` - 再利用可能なUIコンポーネント
- `src/styles/` - グローバルスタイル、Tailwind設定

**開発タスク**:
- スマホファーストのUI実装
- ガチャ演出のアニメーション
- カード表示の最適化
- ユーザー体験の向上

### 端末2: バックエンド API・データベース
**責任範囲**: API設計、データベース操作、認証処理

**主要ファイル**:
- `src/app/api/` - APIルート
- `src/lib/supabase/` - Supabaseクライアント設定
- `supabase/migrations/` - データベーススキーマ

**開発タスク**:
- RESTful API設計
- データベーススキーマ最適化
- 認証フローの実装
- データ整合性の保証

### 端末3: ガチャシステム・確率エンジン
**責任範囲**: ガチャロジック、確率計算、公平性保証

**主要ファイル**:
- `src/lib/gacha/` - ガチャアルゴリズム
- `src/lib/probability/` - 確率計算エンジン

**開発タスク**:
- ガチャアルゴリズムの実装
- レアリティ別確率設定
- 天井システムの実装
- ガチャ履歴の記録

### 端末4: Admin管理・決済システム
**責任範囲**: 管理画面、決済処理、売上管理

**主要ファイル**:
- `src/app/admin/` - 管理画面
- `src/lib/payment/` - Square決済統合

**開発タスク**:
- 管理者認証システム
- カード・ガチャ商品管理
- 決済フローの実装
- 売上レポート機能

### 端末5: 演出・エンタメ
**責任範囲**: ビジュアルエフェクト、サウンド、UXエンハンスメント

**主要ファイル**:
- `src/components/effects/` - エフェクトコンポーネント
- `public/assets/` - 画像、音声リソース

**開発タスク**:
- ガチャ演出の実装
- カード獲得エフェクト
- BGM・効果音の統合
- パフォーマンス最適化

### 端末6: QC・インフラ・DevOps
**責任範囲**: 品質保証、インフラ管理、CI/CD、監視

**主要ファイル**:
- `.github/workflows/` - CI/CD設定
- `scripts/` - 自動化スクリプト
- `tests/` - テストスイート

**開発タスク**:
- CI/CDパイプライン構築
- 自動テストの実装
- パフォーマンス監視
- セキュリティ対策

## コーディング規約

### TypeScript/JavaScript
- 型定義を必須とする
- ESLint/Prettierの設定に従う
- 関数は単一責任の原則に従う

### コンポーネント設計
- 関心の分離を徹底
- Props型定義を明確に
- カスタムフックで状態管理を抽象化

### Git運用
- ブランチ名: `feature/機能名`, `fix/バグ名`
- コミットメッセージ: 日本語で簡潔に
- プルリクエストは必須

## API設計ガイドライン

### エンドポイント命名
```
GET    /api/cards         # カード一覧取得
GET    /api/cards/:id     # カード詳細取得
POST   /api/gacha/draw    # ガチャ実行
GET    /api/user/cards    # ユーザーのカード一覧
```

### レスポンス形式
```json
{
  "success": true,
  "data": {},
  "error": null
}
```

## データベース設計

### 命名規則
- テーブル名: 複数形、スネークケース
- カラム名: スネークケース
- 外部キー: `テーブル名_id`

### インデックス戦略
- 外部キーには必ずインデックス
- 頻繁に検索されるカラムにインデックス
- 複合インデックスは慎重に

## セキュリティガイドライン

### 環境変数
- 本番環境の秘密情報は絶対にコミットしない
- `.env.local`はローカル開発のみ
- 本番環境はNetlify/Vercelの環境変数を使用

### 認証・認可
- Supabase RLSで行レベルセキュリティ
- APIルートでは必ず認証チェック
- 管理者機能は別途認証レイヤー

## パフォーマンス最適化

### フロントエンド
- 画像の遅延読み込み
- コンポーネントの適切なメモ化
- バンドルサイズの監視

### バックエンド
- データベースクエリの最適化
- N+1問題の回避
- 適切なキャッシュ戦略

## 監視とログ

### エラー監視
- Sentryでエラートラッキング
- 重要なAPIエラーは即座に通知

### パフォーマンス監視
- Vercel Analyticsで監視
- Core Web Vitalsの改善

## トラブルシューティング

### よくある問題
1. Supabase接続エラー
   - 環境変数の確認
   - ネットワーク設定の確認

2. ビルドエラー
   - 型定義の不整合
   - 依存関係の更新

3. 決済エラー
   - Square APIキーの確認
   - Webhook設定の確認
# 🚀 本番環境デプロイチェックリスト

**最終更新**: 2025年6月22日 0:00 JST  
**プロジェクト**: エースオリパ (aceoripa)  
**デプロイ予定**: 2025年6月22日 10:00 JST

---

## 📋 事前準備チェックリスト

### 1. コード準備
- [ ] 全テストが合格していることを確認
- [ ] コードレビューが完了していることを確認
- [ ] 最新のmainブランチにマージ済み
- [ ] タグ付けとリリースノート作成完了
- [ ] セキュリティスキャン合格

### 2. 環境設定
- [ ] 本番環境の環境変数設定確認
  - [ ] `NEXT_PUBLIC_SUPABASE_URL`
  - [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - [ ] `SUPABASE_SERVICE_ROLE_KEY`
  - [ ] `SQUARE_APPLICATION_ID`
  - [ ] `SQUARE_ACCESS_TOKEN`
  - [ ] `OPENAI_API_KEY`
  - [ ] `STABILITY_API_KEY`
  - [ ] `CLAUDE_API_KEY`
  - [ ] その他API Keys
- [ ] SSL証明書の有効期限確認（3ヶ月以上）
- [ ] ドメイン設定確認
- [ ] CDN設定確認

### 3. データベース
- [ ] 本番データベースのバックアップ実行
- [ ] マイグレーションスクリプトの準備
- [ ] インデックスの最適化確認
- [ ] 接続プール設定の確認

### 4. インフラストラクチャ
- [ ] Kubernetesクラスター準備完了
- [ ] ロードバランサー設定確認
- [ ] オートスケーリング設定確認
- [ ] 監視・アラート設定確認
- [ ] ログ収集設定確認

---

## 🔄 デプロイ手順

### Phase 1: 準備（9:00-9:30）
- [ ] デプロイチーム全員の出席確認
- [ ] 緊急連絡先リストの確認
- [ ] ロールバック手順の最終確認
- [ ] 全システムのヘルスチェック

### Phase 2: カナリアデプロイ（9:30-11:30）
- [ ] 5%のトラフィックで新バージョンをデプロイ
- [ ] エラー率の監視（閾値: 0.1%以下）
- [ ] レスポンスタイムの監視（閾値: 200ms以下）
- [ ] リソース使用率の監視

### Phase 3: 段階的展開（11:30-14:30）
- [ ] 25%へトラフィック増加
  - [ ] 30分間の監視期間
  - [ ] 問題なし確認
- [ ] 50%へトラフィック増加
  - [ ] 30分間の監視期間
  - [ ] 問題なし確認
- [ ] 75%へトラフィック増加
  - [ ] 30分間の監視期間
  - [ ] 問題なし確認

### Phase 4: 完全切替（14:30-15:00）
- [ ] 100%トラフィック切替
- [ ] 旧バージョンのスタンバイ維持（24時間）
- [ ] 全機能の動作確認
- [ ] パフォーマンス指標の確認

---

## 📊 監視項目

### リアルタイム監視（デプロイ中）
- [ ] HTTP エラー率（4xx, 5xx）
- [ ] API レスポンスタイム
- [ ] データベース接続数
- [ ] CPU/メモリ使用率
- [ ] ネットワークトラフィック

### 機能確認テスト
- [ ] ユーザー登録・ログイン
- [ ] ガチャ実行
- [ ] 決済処理
- [ ] 管理画面アクセス
- [ ] AI画像生成

---

## 🚨 緊急時対応

### ロールバック基準
以下のいずれかが発生した場合、即座にロールバック：
- [ ] エラー率が1%を超える
- [ ] レスポンスタイムが1秒を超える
- [ ] 決済処理でエラーが発生
- [ ] データ不整合が検出される

### ロールバック手順
1. [ ] カナリアデプロイを停止
2. [ ] トラフィックを旧バージョンに100%切替
3. [ ] 新バージョンのPodを削除
4. [ ] インシデントレポート作成
5. [ ] ステークホルダーへの通知

### 緊急連絡先
- **技術責任者**: [連絡先]
- **プロダクトオーナー**: [連絡先]
- **インフラチーム**: [連絡先]
- **カスタマーサポート**: [連絡先]

---

## 📝 デプロイ後タスク

### 即時対応（デプロイ後0-2時間）
- [ ] 全機能の手動確認完了
- [ ] 主要KPIの確認
- [ ] カスタマーサポートへの通知
- [ ] ソーシャルメディアでのアナウンス

### Day 1対応（デプロイ後24時間）
- [ ] ユーザーフィードバックの収集
- [ ] パフォーマンスレポート作成
- [ ] 改善点の洗い出し
- [ ] 次回デプロイ計画の策定

### Week 1対応
- [ ] 詳細な利用分析
- [ ] セキュリティ監査
- [ ] コスト最適化の検討
- [ ] 機能改善の優先順位付け

---

## ✅ 最終確認

**デプロイ実行承認**

- [ ] 全チェック項目の確認完了
- [ ] リスクアセスメント完了
- [ ] ステークホルダーの承認取得
- [ ] デプロイGo判定

**承認者署名**
- 技術責任者: _________________ 日付: _______
- プロダクトオーナー: __________ 日付: _______
- QC責任者: __________________ 日付: _______

---

## 📎 関連ドキュメント

- [QC最終完了報告書](./QC_FINAL_COMPLETION_REPORT.md)
- [デプロイ手順詳細](./docs/deployment-guide.md)
- [ロールバック手順](./docs/rollback-procedure.md)
- [インシデント対応手順](./docs/incident-response.md)
- [監視ダッシュボード](https://monitoring.aceoripa.com)
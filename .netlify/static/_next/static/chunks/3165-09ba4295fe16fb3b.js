"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3165],{609:(e,t,a)=>{a.d(t,{l:()=>u});var i=a(5155),n=a(2115),s=a(760),r=a(6408),o=a(5585),l=a(7437);let c={"rainbow-spiral":{initial:{scale:0,rotate:0,opacity:0},animate:{scale:[0,1.5,1],rotate:[0,360,720],opacity:[0,1,.8,1]},exit:{scale:2,opacity:0}},"fire-burst":{initial:{scale:0,y:100,opacity:0},animate:{scale:[0,1.2,1],y:[100,-20,0],opacity:[0,1,.9]},exit:{y:-100,opacity:0}},"water-splash":{initial:{scale:.5,opacity:0},animate:{scale:[.5,1.1,1],opacity:[0,.8,1]},exit:{scale:.8,opacity:0}},"light-glow":{initial:{opacity:0},animate:{opacity:[0,.6,1]},exit:{opacity:0}}},u=e=>{let{rarity:t,onComplete:a}=e,[u,d]=(0,n.useState)(null),[f,h]=(0,n.useState)(0),[p,m]=(0,n.useState)(!0),y=(0,n.useRef)(null);if((0,n.useEffect)(()=>(y.current=new l.kZ,y.current.loadSounds(),fetch("/assets/effects/effects-config.json").then(e=>e.json()).then(e=>{d(e[t])}),()=>{var e;null==(e=y.current)||e.cleanup()}),[t]),(0,n.useEffect)(()=>{if(!u)return;if(u.sound&&y.current){let e=u.sound.replace(".mp3","");y.current.playSound(e)}if(u.vibration&&"vibrate"in navigator&&navigator.vibrate(u.vibration),"SSR"===t){let e=Date.now()+8e3,t={startVelocity:30,spread:360,ticks:60,zIndex:1e4},a=(e,t)=>Math.random()*(t-e)+e,i=setInterval(function(){let n=e-Date.now();if(n<=0)return clearInterval(i);let s=n/8e3*50;(0,o.A)({...t,particleCount:s,origin:{x:a(.1,.3),y:Math.random()-.2},colors:["#ff0000","#ff7f00","#ffff00","#00ff00","#0000ff","#4b0082","#9400d3"]}),(0,o.A)({...t,particleCount:s,origin:{x:a(.7,.9),y:Math.random()-.2},colors:["#ff0000","#ff7f00","#ffff00","#00ff00","#0000ff","#4b0082","#9400d3"]})},250)}let e=setTimeout(()=>{m(!1),a()},u.duration);return()=>clearTimeout(e)},[u,t,a]),(0,n.useEffect)(()=>{if(!u||!p)return;let e=setInterval(()=>{h(e=>(e+1)%u.files.length)},u.duration/u.files.length);return()=>clearInterval(e)},[u,p]),!u)return null;let x=c[u.animation];return(0,i.jsx)(s.N,{children:p&&(0,i.jsx)(r.P.div,{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)(r.P.div,{className:"relative",variants:x,initial:"initial",animate:"animate",exit:"exit",transition:{duration:u.duration/1e3},children:(0,i.jsx)("img",{src:"/assets/effects/".concat(t.toLowerCase(),"-").concat(u.animation,"/").concat(u.files[f]),alt:"".concat(t," effect"),className:"w-96 h-96 object-contain"})})})})}},5101:(e,t,a)=>{a.d(t,{X:()=>l});var i=a(5155),n=a(2115),s=a(760),r=a(6408);class o{async generateGachaVideo(e,t){try{let a=this.selectAssets(e);await this.loadAssets(a),null==t||t(20);let i=this.createTimeline(e);null==t||t(40);let n=await this.renderVideo(i,e=>{null==t||t(40+.6*e)});return null==t||t(100),n}catch(e){throw console.error("Video generation failed:",e),e}}selectAssets(e){let t=[];return t.push(this.selectBackground(e.theme||"fantasy")),t.push(...this.selectEffects(e.rarity)),t.push("treasure-box-closed.webp","treasure-box-open.webp"),t.push("ui-".concat(e.rarity.toLowerCase(),"-text.webp")),t}selectBackground(e){let t={fantasy:"bg-ancient-temple.webp","sci-fi":"bg-cosmic-space.webp",modern:"bg-city-night.webp",cute:"bg-fairy-garden.webp"};return t[e]||t.fantasy}selectEffects(e){let t={SSR:["effect-rainbow-aura.webp","effect-golden-particles.webp","effect-light-explosion.webp","effect-divine-rays.webp"],SR:["effect-fire-aura.webp","effect-flame-particles.webp","effect-red-explosion.webp"],R:["effect-blue-aura.webp","effect-water-particles.webp"],N:["effect-white-glow.webp","effect-gentle-sparkles.webp"]};return t[e]||t.N}async loadAssets(e){let t=e.map(async e=>{if(this.assets.has(e))return;let t=new Image;t.crossOrigin="anonymous",t.src=await this.createPlaceholderAsset(e),await t.decode(),this.assets.set(e,t)});await Promise.all(t)}async createPlaceholderAsset(e){let t=document.createElement("canvas");t.width=512,t.height=512;let a=t.getContext("2d"),i="#333";if(e.includes("bg-"))i="#1a1a2e";else if(e.includes("effect-rainbow")){let e=a.createLinearGradient(0,0,512,512);e.addColorStop(0,"#ff0000"),e.addColorStop(.17,"#ff7f00"),e.addColorStop(.33,"#ffff00"),e.addColorStop(.5,"#00ff00"),e.addColorStop(.67,"#0000ff"),e.addColorStop(.83,"#4b0082"),e.addColorStop(1,"#9400d3"),i=e}else e.includes("effect-fire")?i="#ff4500":e.includes("effect-blue")||e.includes("water")?i="#00bfff":e.includes("effect-golden")&&(i="#ffd700");return a.fillStyle=i,a.fillRect(0,0,512,512),a.fillStyle="#fff",a.font="bold 24px Arial",a.textAlign="center",a.textBaseline="middle",a.fillText(e.replace(".webp","").replace(/-/g," "),256,256),t.toDataURL()}createTimeline(e){switch(e.rarity){case"SSR":return this.buildSSRTimeline(e);case"SR":return this.buildSRTimeline(e);case"R":return this.buildRTimeline(e);default:return this.buildNTimeline(e)}}buildSSRTimeline(e){return[{time:0,duration:1e3,layers:[{type:"background",asset:this.selectBackground(e.theme||"fantasy"),transform:{x:960,y:540,scale:1.2,rotation:0,opacity:0},animation:{from:{opacity:0,scale:1.2},to:{opacity:1,scale:1},easing:"ease-in"}},{type:"object",asset:"treasure-box-closed.webp",transform:{x:960,y:700,scale:0,rotation:0,opacity:0},animation:{from:{scale:0,y:700,opacity:0},to:{scale:1,y:540,opacity:1},easing:"bounce-out"}}]},{time:1e3,duration:2e3,layers:[{type:"effect",asset:"effect-golden-particles.webp",transform:{x:960,y:540,scale:.5,rotation:0,opacity:.7},animation:{from:{scale:.5,opacity:.7,rotation:0},to:{scale:1.5,opacity:1,rotation:180},easing:"ease-in-out"}}]},{time:3e3,duration:1e3,layers:[{type:"effect",asset:"effect-light-explosion.webp",transform:{x:960,y:540,scale:0,rotation:0,opacity:1},animation:{from:{scale:0},to:{scale:3},easing:"expo-out"}},{type:"object",asset:"treasure-box-open.webp",transform:{x:960,y:540,scale:1,rotation:0,opacity:0},animation:{from:{opacity:0},to:{opacity:1},easing:"ease-out"}}]},{time:4e3,duration:4e3,layers:[{type:"effect",asset:"effect-rainbow-aura.webp",transform:{x:960,y:540,scale:1,rotation:0,opacity:1},animation:{from:{rotation:0},to:{rotation:720},easing:"linear"}},{type:"ui",asset:"ui-ssr-text.webp",transform:{x:960,y:200,scale:0,rotation:0,opacity:0},animation:{from:{scale:0,opacity:0},to:{scale:1,opacity:1},easing:"elastic-out"}}]}]}buildSRTimeline(e){return[{time:0,duration:1e3,layers:[{type:"background",asset:this.selectBackground(e.theme||"fantasy"),transform:{x:960,y:540,scale:1,rotation:0,opacity:0},animation:{from:{opacity:0},to:{opacity:1},easing:"ease-in"}}]},{time:1e3,duration:2e3,layers:[{type:"effect",asset:"effect-fire-aura.webp",transform:{x:960,y:540,scale:.5,rotation:0,opacity:.8},animation:{from:{scale:.5,opacity:.8},to:{scale:1.2,opacity:1},easing:"ease-out"}}]}]}buildRTimeline(e){return[{time:0,duration:1500,layers:[{type:"effect",asset:"effect-water-particles.webp",transform:{x:960,y:540,scale:1,rotation:0,opacity:.8},animation:{from:{opacity:0},to:{opacity:.8},easing:"ease-in-out"}}]}]}buildNTimeline(e){return[{time:0,duration:1e3,layers:[{type:"effect",asset:"effect-white-glow.webp",transform:{x:960,y:540,scale:1,rotation:0,opacity:.5},animation:{from:{opacity:0},to:{opacity:.5},easing:"ease-in-out"}}]}]}async renderVideo(e,t){let a=Math.ceil(Math.max(...e.map(e=>e.time+e.duration))/33.333333333333336),i=new MediaRecorder(this.canvas.captureStream(30),{mimeType:"video/webm;codecs=vp8",videoBitsPerSecond:25e5}),n=[];i.ondataavailable=e=>n.push(e.data),i.start();for(let i=0;i<a;i++){let n=33.333333333333336*i;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,1920,1080),e.forEach(e=>{if(n>=e.time&&n<e.time+e.duration){let t=n-e.time;e.layers.forEach(a=>{this.drawLayer(a,t,e.duration)})}}),null==t||t(i/a),await new Promise(e=>setTimeout(e,33.333333333333336))}return i.stop(),new Promise(e=>{i.onstop=()=>{e(new Blob(n,{type:"video/webm"}))}})}drawLayer(e,t,a){let i=Math.min(t/a,1),n=this.interpolateTransform(e,i);this.ctx.save(),this.ctx.globalAlpha=n.opacity,this.ctx.translate(n.x,n.y),this.ctx.scale(n.scale,n.scale),this.ctx.rotate(n.rotation*Math.PI/180);let s=this.assets.get(e.asset);s&&this.ctx.drawImage(s,-s.width/2,-s.height/2),this.ctx.restore()}interpolateTransform(e,t){if(!e.animation)return e.transform;let{from:a,to:i,easing:n}=e.animation,s=this.applyEasing(t,n),r={...e.transform};return Object.keys(a).forEach(e=>{var t,n;let o=null!=(t=a[e])?t:r[e],l=null!=(n=i[e])?n:r[e];r[e]=o+(l-o)*s}),r}applyEasing(e,t){var a;let i={linear:e=>e,"ease-in":e=>e*e,"ease-out":e=>e*(2-e),"ease-in-out":e=>e<.5?2*e*e:-1+(4-2*e)*e,"bounce-out":e=>e<.36363636363636365?7.5625*e*e:e<.7272727272727273?7.5625*(e-=.5454545454545454)*e+.75:e<.9090909090909091?7.5625*(e-=.8181818181818182)*e+.9375:7.5625*(e-=.9545454545454546)*e+.984375,"elastic-out":e=>{let t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},"expo-out":e=>1===e?1:1-Math.pow(2,-10*e)};return(null==(a=i[t])?void 0:a.call(i,e))||e}cleanup(){var e;this.assets.clear(),null==(e=this.audioContext)||e.close()}constructor(e){this.offscreenCanvas=null,this.offscreenCtx=null,this.assets=new Map,this.audioContext=null,this.canvas=e,this.canvas.width=1920,this.canvas.height=1080,this.ctx=this.canvas.getContext("2d",{alpha:!1}),"undefined"!=typeof OffscreenCanvas&&(this.offscreenCanvas=new OffscreenCanvas(1920,1080),this.offscreenCtx=this.offscreenCanvas.getContext("2d"))}}let l=e=>{let{result:t,onComplete:a,autoPlay:l=!0}=e,c=(0,n.useRef)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),[f,h]=(0,n.useState)("idle"),[p,m]=(0,n.useState)(0),[y,x]=(0,n.useState)(null),[b,g]=(0,n.useState)(null);(0,n.useEffect)(()=>(c.current&&!d.current&&(d.current=new o(c.current)),()=>{var e;null==(e=d.current)||e.cleanup(),y&&URL.revokeObjectURL(y)}),[]),(0,n.useEffect)(()=>{l&&"idle"===f&&w()},[l,f]);let w=async()=>{if(d.current){h("generating"),g(null),m(0);try{let e=await d.current.generateGachaVideo(t,e=>{m(Math.round(e))}),a=URL.createObjectURL(e);x(a),h("ready"),l&&u.current&&u.current.play()}catch(e){console.error("Video generation failed:",e),g("動画生成に失敗しました"),h("idle")}}};return(0,i.jsxs)("div",{className:"relative w-full h-full bg-black rounded-lg overflow-hidden",children:[(0,i.jsx)("canvas",{ref:c,className:"hidden",width:1920,height:1080}),(0,i.jsxs)(s.N,{children:["generating"===f&&(0,i.jsxs)(r.P.div,{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/90 z-20",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,i.jsx)("div",{className:"text-white text-xl mb-4",children:"演出動画を生成中..."}),(0,i.jsx)("div",{className:"w-64 h-2 bg-gray-700 rounded-full overflow-hidden",children:(0,i.jsx)(r.P.div,{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500",initial:{width:0},animate:{width:"".concat(p,"%")},transition:{duration:.3}})}),(0,i.jsxs)("div",{className:"text-white/60 mt-2",children:[p,"%"]})]}),b&&(0,i.jsxs)(r.P.div,{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/90 z-20",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,i.jsx)("div",{className:"text-red-500 text-xl mb-4",children:b}),(0,i.jsx)("button",{onClick:w,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"再試行"})]})]}),y&&(0,i.jsxs)("div",{className:"relative w-full h-full",children:[(0,i.jsx)("video",{ref:u,src:y,className:"w-full h-full object-contain",onPlay:()=>h("playing"),onEnded:()=>{h("completed"),null==a||a()},controls:!1,playsInline:!0,muted:!1}),"completed"===f&&(0,i.jsx)(r.P.div,{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:(0,i.jsx)("button",{onClick:()=>{u.current&&(u.current.currentTime=0,u.current.play(),h("playing"))},className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"もう一度見る"})})]}),(0,i.jsx)(r.P.div,{className:"absolute top-4 right-4",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:(0,i.jsx)("div",{className:"px-4 py-2 rounded-full font-bold text-white ".concat("SSR"===t.rarity?"bg-gradient-to-r from-yellow-400 to-pink-500":"SR"===t.rarity?"bg-gradient-to-r from-red-500 to-orange-500":"R"===t.rarity?"bg-gradient-to-r from-blue-500 to-cyan-500":"bg-gradient-to-r from-gray-500 to-gray-600"),children:t.rarity})})]})}},7437:(e,t,a)=>{a.d(t,{RO:()=>l,kZ:()=>r});var i=a(5155),n=a(2115);let s={"ssr-legendary":{url:"/sounds/ssr-legendary.mp3",volume:.8,duration:8e3},"sr-epic":{url:"/sounds/sr-epic.mp3",volume:.7,duration:5e3},"r-rare":{url:"/sounds/r-rare.mp3",volume:.6,duration:3e3},"n-common":{url:"/sounds/n-common.mp3",volume:.5,duration:2e3},"coin-drop":{url:"/sounds/coin-drop.mp3",volume:.4,duration:500},"chest-open":{url:"/sounds/chest-open.mp3",volume:.6,duration:1e3},"magic-sparkle":{url:"/sounds/magic-sparkle.mp3",volume:.5,duration:2e3}};class r{async loadSounds(){if(this.audioContext&&!this.isLoaded){for(let[e,t]of Object.entries(s))try{let a=await this.createPlaceholderSound(e,t.duration||1e3);this.sounds.set(e,a)}catch(t){console.warn("音声ロード失敗: ".concat(e),t)}this.isLoaded=!0}}async createPlaceholderSound(e,t){if(!this.audioContext)throw Error("AudioContext not initialized");let a=this.audioContext.sampleRate,i=t/1e3*a,n=this.audioContext.createBuffer(1,i,a),s=n.getChannelData(0);switch(e){case"ssr-legendary":for(let e=0;e<i;e++){let t=e/a;s[e]=.2*Math.sin(2*Math.PI*523.25*t)+.2*Math.sin(2*Math.PI*659.25*t)+.2*Math.sin(2*Math.PI*783.99*t)+.1*Math.sin(2*Math.PI*1046.5*t)+.1*Math.sin(2*Math.PI*1318.51*t);let n=Math.min(1,e/(.1*a))*Math.max(0,1-(e-.7*i)/(.3*i));s[e]*=.5*n}break;case"sr-epic":for(let e=0;e<i;e++){let t=e/a;s[e]=.3*Math.sin(2*Math.PI*440*t)+.2*Math.sin(2*Math.PI*554.37*t)+.2*Math.sin(2*Math.PI*659.25*t);let i=Math.min(1,e/(.05*a))*Math.exp(-e/(2*a));s[e]*=i}break;case"r-rare":for(let e=0;e<i;e++){let t=e/a;s[e]=.3*Math.sin(2*Math.PI*493.88*t)+.2*Math.sin(2*Math.PI*587.33*t);let i=Math.exp(-e/(1.5*a));s[e]*=i}break;case"n-common":for(let e=0;e<i;e++){let t=e/a;s[e]=.3*Math.sin(2*Math.PI*440*t);let i=Math.exp(-e/a);s[e]*=i}break;case"coin-drop":for(let e=0;e<i;e++){let t=e/a,i=2e3*Math.exp(-(3*t));s[e]=Math.sin(2*Math.PI*i*t)*Math.exp(-(10*t))}break;case"chest-open":for(let e=0;e<i;e++){let t=e/a;s[e]=(Math.random()-.5)*.3*Math.exp(-(5*t))+.2*Math.sin(2*Math.PI*200*t)*Math.exp(-(3*t))}break;case"magic-sparkle":for(let e=0;e<i;e++){let t=e/a,i=1e3+500*Math.sin(2*Math.PI*10*t);s[e]=.1*Math.sin(2*Math.PI*i*t)*Math.sin(2*Math.PI*50*t)}break;default:for(let e=0;e<i;e++)s[e]=(Math.random()-.5)*.1*Math.exp(-e/(.5*a))}return n}async playSound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!this.audioContext||this.isMuted)return;"suspended"===this.audioContext.state&&await this.audioContext.resume();let a=this.sounds.get(e);if(!a)return void console.warn("音声が見つかりません: ".concat(e));let i=this.audioContext.createBufferSource(),n=this.audioContext.createGain();i.buffer=a,i.connect(n),n.connect(this.audioContext.destination);let r=s[e];n.gain.value=((null==r?void 0:r.volume)||1)*t*this.masterVolume,i.start(0)}setMuted(e){this.isMuted=e}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e))}cleanup(){this.audioContext&&this.audioContext.close(),this.sounds.clear()}constructor(){this.audioContext=null,this.sounds=new Map,this.isLoaded=!1,this.isMuted=!1,this.masterVolume=1,this.audioContext=new(window.AudioContext||window.webkitAudioContext)}}let o=()=>{let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(!1),[i,s]=(0,n.useState)(!1),[o,l]=(0,n.useState)(1);return(0,n.useEffect)(()=>(e.current=new r,e.current.loadSounds().then(()=>{a(!0)}),()=>{var t;null==(t=e.current)||t.cleanup()}),[]),{playSound:(t,a)=>{var i;null==(i=e.current)||i.playSound(t,a)},isReady:t,isMuted:i,toggleMute:()=>{var t;let a=!i;s(a),null==(t=e.current)||t.setMuted(a)},volume:o,changeVolume:t=>{var a;l(t),null==(a=e.current)||a.setMasterVolume(t)}}},l=()=>{let{isMuted:e,toggleMute:t,volume:a,changeVolume:n,playSound:s}=o();return(0,i.jsx)("div",{className:"fixed bottom-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-4",children:(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)("button",{onClick:t,className:"p-2 rounded-full hover:bg-gray-100 transition-colors",title:e?"音声をONにする":"音声をOFFにする",children:e?"\uD83D\uDD07":"\uD83D\uDD0A"}),(0,i.jsx)("input",{type:"range",min:"0",max:"100",value:100*a,onChange:e=>n(Number(e.target.value)/100),className:"w-24",disabled:e}),(0,i.jsx)("button",{onClick:()=>s("magic-sparkle"),className:"text-xs bg-purple-500 text-white px-2 py-1 rounded hover:bg-purple-600",children:"テスト"})]})})}}}]);
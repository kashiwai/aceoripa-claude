(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1283],{5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},6620:(e,s,t)=>{Promise.resolve().then(t.bind(t,7114))},6681:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(2115),l=t(1720),r=t(5695),n=t(3568);function i(){let[e,s]=(0,a.useState)(null),[t,i]=(0,a.useState)(!0),c=(0,l.kT)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"),o=(0,r.useRouter)();return(0,a.useEffect)(()=>{(async()=>{let{data:{user:e}}=await c.auth.getUser();s(e),i(!1)})();let{data:{subscription:e}}=c.auth.onAuthStateChange((e,t)=>{var a;s(null!=(a=null==t?void 0:t.user)?a:null)});return()=>e.unsubscribe()},[c]),{user:e,loading:t,signIn:async(e,s)=>{try{let{error:t}=await c.auth.signInWithPassword({email:e,password:s});if(t)throw t;n.oR.success("ログインしました"),o.push("/")}catch(e){throw console.error("Sign in error:",e),n.oR.error("ログインに失敗しました"),e}},signUp:async(e,s,t)=>{try{let{error:a}=await c.auth.signUp({email:e,password:s,options:{data:{username:t}}});if(a)throw a;n.oR.success("アカウントを作成しました"),o.push("/")}catch(e){throw console.error("Sign up error:",e),n.oR.error("アカウント作成に失敗しました"),e}},signOut:async()=>{try{let{error:e}=await c.auth.signOut();if(e)throw e;n.oR.success("ログアウトしました"),o.push("/")}catch(e){throw console.error("Sign out error:",e),n.oR.error("ログアウトに失敗しました"),e}}}}},7114:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var a=t(5155),l=t(2115),r=t(609),n=t(5101);t(7437);var i=t(6874),c=t.n(i),o=t(3568),d=t(6681),u=t(5695);function x(){let[e,s]=(0,l.useState)(!1),[t,i]=(0,l.useState)(!1),[x,h]=(0,l.useState)("N"),[m,p]=(0,l.useState)([]),[f,b]=(0,l.useState)(!1),[j,g]=(0,l.useState)({total:0,free:0,paid:0}),{executeGacha:N,isLoading:y,clearResults:v}=function(){let[e,s]=(0,l.useState)(!1),[t,a]=(0,l.useState)([]);return{executeGacha:(0,l.useCallback)(async(e,t)=>{s(!0);try{let s=await fetch("/api/gacha/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e,pullCount:t})}),l=await s.json();if(!s.ok)throw Error(l.error||"ガチャの実行に失敗しました");if(l.success){a(l.results);let e=l.results.filter(e=>e.isNew);return e.length>0&&o.oR.success("新規カード".concat(e.length,"枚獲得！")),l.results.filter(e=>"SSR"===e.rarity).length>0&&o.oR.success("\uD83C\uDF89 SSR獲得！おめでとうございます！",{duration:5e3,style:{background:"#FFD700",color:"#000",fontWeight:"bold"}}),l}throw Error("ガチャの実行に失敗しました")}catch(e){throw console.error("Gacha error:",e),o.oR.error(e instanceof Error?e.message:"エラーが発生しました"),e}finally{s(!1)}},[]),clearResults:(0,l.useCallback)(()=>{a([])},[]),isLoading:e,results:t}}(),{user:w,loading:S}=(0,d.A)(),R=(0,u.useRouter)();(0,l.useEffect)(()=>{S||w||(o.oR.error("ログインが必要です"),R.push("/auth/login"))},[w,S,R]),(0,l.useEffect)(()=>{(async()=>{if(w)try{let e=await fetch("/api/user/points");if(e.ok){let s=await e.json();g({total:s.free_points+s.paid_points,free:s.free_points,paid:s.paid_points})}}catch(e){console.error("Failed to fetch user points:",e)}})()},[w]);let k=async e=>{if(!w){o.oR.error("ログインが必要です"),R.push("/auth/login");return}let t=1===e?150:1500;if(j.total<t){o.oR.error("ポイントが不足しています"),R.push("/payment");return}try{let t=await N("g001",e);if(t.success){p(t.results);let e=t.results.map(e=>e.rarity),a=e.includes("SSR")?"SSR":e.includes("SR")?"SR":e.includes("R")?"R":"N";h(a),g(t.remainingPoints),i(!1),s(!0)}}catch(e){console.error("Gacha failed:",e),o.oR.error("ガチャの実行に失敗しました")}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("main",{className:"min-h-screen bg-gray-900 text-white",children:[(0,a.jsx)("div",{className:"bg-gray-800 p-4 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"container mx-auto flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"ガチャ"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-yellow-400",children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{children:j.total.toLocaleString()})]})]})}),e&&(0,a.jsx)("div",{className:"fixed inset-0 z-50",children:(0,a.jsx)(r.l,{rarity:x,onComplete:()=>{s(!1),i(!0),"SSR"===x&&b(!0)}})}),f&&(0,a.jsx)("div",{className:"fixed inset-0 z-40 bg-black",children:(0,a.jsx)(n.X,{result:{rarity:"SSR",item:{id:"temp-id",name:"テストカード",imageUrl:"/api/placeholder/300/400"}},onComplete:()=>{b(!1)}})}),t&&!f&&(0,a.jsx)("div",{className:"fixed inset-0 z-30 bg-black/90 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-center mb-6",children:"ガチャ結果"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:m.map(e=>(0,a.jsxs)("div",{className:"relative rounded-lg overflow-hidden transform transition-all hover:scale-105 ".concat("SSR"===e.rarity?"ring-4 ring-yellow-400":"SR"===e.rarity?"ring-4 ring-purple-400":"R"===e.rarity?"ring-4 ring-blue-400":""),children:[(0,a.jsx)("img",{src:e.imageUrl,alt:e.cardName,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute top-2 right-2 px-2 py-1 rounded bg-black/70 text-xs font-bold",children:e.rarity}),e.isNew&&(0,a.jsx)("div",{className:"absolute bottom-2 left-2 px-2 py-1 rounded bg-red-600 text-xs font-bold",children:"NEW!"}),e.isPickup&&(0,a.jsx)("div",{className:"absolute top-2 left-2 px-2 py-1 rounded bg-yellow-600 text-xs font-bold",children:"PICKUP"})]},e.cardId))}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{s(!1),i(!1),b(!1),p([]),v()},className:"px-8 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition-colors",children:"もう一度"}),(0,a.jsx)(c(),{href:"/",className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition-colors",children:"ホームに戻る"})]})]})}),!e&&!t&&(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("section",{className:"mb-8",children:(0,a.jsxs)("div",{className:"relative rounded-2xl overflow-hidden",children:[(0,a.jsx)("img",{src:"/api/placeholder/1200/400",alt:"期間限定ガチャ",className:"w-full h-auto"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end p-8",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"期間限定！伝説の英雄ガチャ"}),(0,a.jsx)("p",{className:"text-lg opacity-90",children:"SSR確率2倍キャンペーン実施中"})]})})]})}),(0,a.jsx)("section",{className:"mb-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto",children:[(0,a.jsxs)("button",{onClick:()=>k(1),disabled:y||j.total<150,className:"bg-gradient-to-br from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 rounded-2xl p-8 transform transition-all hover:scale-105 shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFB2"}),(0,a.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"単発ガチャ"}),(0,a.jsx)("p",{className:"text-lg opacity-90 mb-4",children:"1回引く"}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("span",{className:"text-yellow-400 text-2xl",children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{className:"text-3xl font-bold",children:"150"})]})]}),(0,a.jsxs)("button",{onClick:()=>k(10),disabled:y||j.total<1500,className:"bg-gradient-to-br from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-2xl p-8 transform transition-all hover:scale-105 shadow-2xl relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[(0,a.jsx)("div",{className:"absolute top-4 right-4 bg-yellow-400 text-black px-3 py-1 rounded-full text-sm font-bold",children:"SR以上確定！"}),(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFB0"}),(0,a.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"10連ガチャ"}),(0,a.jsx)("p",{className:"text-lg opacity-90 mb-4",children:"10回引く"}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("span",{className:"text-yellow-400 text-2xl",children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{className:"text-3xl font-bold",children:"1,500"})]})]})]})}),(0,a.jsxs)("section",{className:"mb-8 max-w-2xl mx-auto",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 text-center",children:"提供割合"}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-xl p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),(0,a.jsx)("span",{children:"SSR"})]}),(0,a.jsx)("span",{className:"font-bold",children:"3.0%"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-purple-400 rounded-full"}),(0,a.jsx)("span",{children:"SR"})]}),(0,a.jsx)("span",{className:"font-bold",children:"12.0%"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-blue-400 rounded-full"}),(0,a.jsx)("span",{children:"R"})]}),(0,a.jsx)("span",{className:"font-bold",children:"25.0%"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-gray-400 rounded-full"}),(0,a.jsx)("span",{children:"N"})]}),(0,a.jsx)("span",{className:"font-bold",children:"60.0%"})]})]})})]}),(0,a.jsxs)("section",{className:"text-center text-gray-400 text-sm",children:[(0,a.jsx)("p",{children:"※ ゲーム内通貨でのガチャとなります"}),(0,a.jsx)("p",{children:"※ 獲得したカードは重複する場合があります"})]})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[6874,3568,4982,1720,6408,744,3165,8441,1684,7358],()=>s(6620)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7610],{3693:(e,t,s)=>{Promise.resolve().then(s.bind(s,3911))},3911:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(5155),r=s(2115),n=s(1720),i=s(3568);let l=r.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}),d=r.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});var c=s(3930),o=s(6865);function p(){let e=(0,n.kT)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"),[t,s]=(0,r.useState)([]),[p,u]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[h,g]=(0,r.useState)(""),[y,f]=(0,r.useState)("all"),[v,j]=(0,r.useState)("all"),[w,b]=(0,r.useState)(!1),[N,_]=(0,r.useState)(null),[k,C]=(0,r.useState)({status:"",tracking_number:"",shipping_company:"",notes:""});(0,r.useEffect)(()=>{L()},[]),(0,r.useEffect)(()=>{E()},[t,h,y,v]);let L=async()=>{try{let{data:t,error:a}=await e.from("shipments").select("\n          *,\n          users(email, username),\n          shipment_items(\n            id,\n            card_id,\n            quantity,\n            unit_price,\n            cards(name)\n          )\n        ").order("created_at",{ascending:!1});if(a)throw a;let r=(null==t?void 0:t.map(e=>{var t,s,a;return{id:e.id,user_id:e.user_id,user_email:(null==(t=e.users)?void 0:t.email)||"",user_name:(null==(s=e.users)?void 0:s.username)||"",shipping_address:e.shipping_address,items:(null==(a=e.shipment_items)?void 0:a.map(e=>{var t;return{id:e.id,card_id:e.card_id,card_name:(null==(t=e.cards)?void 0:t.name)||"",quantity:e.quantity,unit_price:e.unit_price}}))||[],status:e.status,tracking_number:e.tracking_number,shipping_company:e.shipping_company,total_amount:e.total_amount,shipping_fee:e.shipping_fee,created_at:e.created_at,shipped_at:e.shipped_at,delivered_at:e.delivered_at,notes:e.notes}}))||[];s(r)}catch(e){console.error("Error fetching shipments:",e),i.oR.error("発送データの取得に失敗しました")}finally{x(!1)}},E=()=>{let e=[...t];if(h&&(e=e.filter(e=>{var t;return e.user_email.toLowerCase().includes(h.toLowerCase())||e.user_name.toLowerCase().includes(h.toLowerCase())||(null==(t=e.tracking_number)?void 0:t.toLowerCase().includes(h.toLowerCase()))||e.id.toLowerCase().includes(h.toLowerCase())})),"all"!==y&&(e=e.filter(e=>e.status===y)),"all"!==v){let t=new Date,s=new Date;switch(v){case"today":s.setHours(0,0,0,0);break;case"week":s.setDate(t.getDate()-7);break;case"month":s.setMonth(t.getMonth()-1)}"all"!==v&&(e=e.filter(e=>new Date(e.created_at)>=s))}u(e)},S=async(t,s,a,r,n)=>{try{x(!0);let l={status:s,notes:n||null};"shipped"===s?(l.shipped_at=new Date().toISOString(),l.tracking_number=a||null,l.shipping_company=r||null):"delivered"===s&&(l.delivered_at=new Date().toISOString());let{error:d}=await e.from("shipments").update(l).eq("id",t);if(d)throw d;i.oR.success("発送状況を更新しました"),L(),b(!1),_(null)}catch(e){console.error("Error updating shipment:",e),i.oR.error("更新に失敗しました")}finally{x(!1)}},R=async e=>{try{let t=await fetch("/api/admin/shipments/generate-label",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shipmentId:e.id,shippingAddress:e.shipping_address,items:e.items})});if(!t.ok)throw Error("ラベル生成に失敗しました");let s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download="shipping-label-".concat(e.id,".pdf"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r),i.oR.success("配送ラベルを生成しました")}catch(e){console.error("Error generating shipping label:",e),i.oR.error("ラベル生成に失敗しました")}},O=async()=>{try{let e=["発送ID,ユーザーメール,ユーザー名,住所,商品,数量,ステータス,追跡番号,作成日",...p.map(e=>[e.id,e.user_email,e.user_name,"".concat(e.shipping_address.prefecture).concat(e.shipping_address.city).concat(e.shipping_address.address_line1),e.items.map(e=>"".concat(e.card_name,"(").concat(e.quantity,")")).join(";"),e.items.reduce((e,t)=>e+t.quantity,0),D(e.status),e.tracking_number||"",new Date(e.created_at).toLocaleDateString("ja-JP")].join(","))].join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="shipments-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),i.oR.success("CSVファイルをダウンロードしました")}catch(e){console.error("Error exporting shipments:",e),i.oR.error("エクスポートに失敗しました")}},I=e=>{_(e),C({status:e.status,tracking_number:e.tracking_number||"",shipping_company:e.shipping_company||"",notes:e.notes||""}),b(!0)},D=e=>({pending:"受注待ち",preparing:"準備中",shipped:"発送済み",delivered:"配達完了",cancelled:"キャンセル"})[e]||e,M=e=>({pending:"bg-gray-100 text-gray-800",preparing:"bg-yellow-100 text-yellow-800",shipped:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"発送管理"}),(0,a.jsxs)("button",{onClick:O,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center gap-2",children:[(0,a.jsx)(l,{className:"h-5 w-5"}),"CSVエクスポート"]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow flex flex-wrap gap-4",children:[(0,a.jsx)("div",{className:"flex-1 min-w-64",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"ユーザー名、メール、追跡番号で検索...",value:h,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:y,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"全ステータス"}),(0,a.jsx)("option",{value:"pending",children:"受注待ち"}),(0,a.jsx)("option",{value:"preparing",children:"準備中"}),(0,a.jsx)("option",{value:"shipped",children:"発送済み"}),(0,a.jsx)("option",{value:"delivered",children:"配達完了"}),(0,a.jsx)("option",{value:"cancelled",children:"キャンセル"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:v,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"全期間"}),(0,a.jsx)("option",{value:"today",children:"今日"}),(0,a.jsx)("option",{value:"week",children:"過去1週間"}),(0,a.jsx)("option",{value:"month",children:"過去1ヶ月"})]})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:["pending","preparing","shipped","delivered"].map(e=>{let t=p.filter(t=>t.status===e).length;return(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"p-2 rounded-full ".concat(M(e)),children:["pending"===e&&(0,a.jsx)(l,{className:"h-6 w-6"}),"preparing"===e&&(0,a.jsx)(l,{className:"h-6 w-6"}),"shipped"===e&&(0,a.jsx)(c.A,{className:"h-6 w-6"}),"delivered"===e&&(0,a.jsx)(o.A,{className:"h-6 w-6"})]}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:D(e)}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:t})]})]})},e)})}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,a.jsx)("div",{className:"px-4 py-5 sm:p-6",children:m?(0,a.jsx)("div",{className:"text-center py-4",children:"読み込み中..."}):0===p.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"該当する発送がありません"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"発送ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ユーザー"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"配送先"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"商品"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金額"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"追跡番号"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"作成日"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.id.slice(0,8),"..."]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.user_name||"名前なし"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.user_email})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:["〒",e.shipping_address.postal_code]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.shipping_address.prefecture,e.shipping_address.city]})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.items.length,"品目"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["計",e.items.reduce((e,t)=>e+t.quantity,0),"個"]})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["\xa5",e.total_amount.toLocaleString()]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(M(e.status)),children:D(e.status)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.tracking_number||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>I(e),className:"text-indigo-600 hover:text-indigo-900",children:"編集"}),("preparing"===e.status||"shipped"===e.status)&&(0,a.jsx)("button",{onClick:()=>R(e),className:"text-blue-600 hover:text-blue-900",children:"ラベル"})]})})]},e.id))})]})})})}),w&&N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"発送情報編集"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ステータス"}),(0,a.jsxs)("select",{value:k.status,onChange:e=>C({...k,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"pending",children:"受注待ち"}),(0,a.jsx)("option",{value:"preparing",children:"準備中"}),(0,a.jsx)("option",{value:"shipped",children:"発送済み"}),(0,a.jsx)("option",{value:"delivered",children:"配達完了"}),(0,a.jsx)("option",{value:"cancelled",children:"キャンセル"})]})]}),("shipped"===k.status||"delivered"===k.status)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"配送会社"}),(0,a.jsxs)("select",{value:k.shipping_company,onChange:e=>C({...k,shipping_company:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),(0,a.jsx)("option",{value:"yamato",children:"ヤマト運輸"}),(0,a.jsx)("option",{value:"sagawa",children:"佐川急便"}),(0,a.jsx)("option",{value:"japan_post",children:"日本郵便"}),(0,a.jsx)("option",{value:"other",children:"その他"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"追跡番号"}),(0,a.jsx)("input",{type:"text",value:k.tracking_number,onChange:e=>C({...k,tracking_number:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"追跡番号を入力"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"備考"}),(0,a.jsx)("textarea",{value:k.notes,onChange:e=>C({...k,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"備考を入力"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{b(!1),_(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"キャンセル"}),(0,a.jsx)("button",{onClick:()=>S(N.id,k.status,k.tracking_number,k.shipping_company,k.notes),disabled:m,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:m?"更新中...":"更新"})]})]})]})})]})}},3930:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(2115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"}))})},6865:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(2115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[3568,4982,1720,8441,1684,7358],()=>t(3693)),_N_E=e.O()}]);